(function (factory) {
    if (typeof module === 'object' && typeof module.exports === 'object') {
        var v = factory(require, exports); if (v !== undefined) module.exports = v;
    }
    else if (typeof define === 'function' && define.amd) {
        define(["require", "exports", '../Promise', './SizeQueue', './util'], factory);
    }
})(function (require, exports) {
    "use strict";
    var Promise_1 = require('../Promise');
    var SizeQueue_1 = require('./SizeQueue');
    var util = require('./util');
    /**
     * WritableStream's possible states
     */
    (function (State) {
        State[State["Closed"] = 0] = "Closed";
        State[State["Closing"] = 1] = "Closing";
        State[State["Errored"] = 2] = "Errored";
        State[State["Waiting"] = 3] = "Waiting";
        State[State["Writable"] = 4] = "Writable";
    })(exports.State || (exports.State = {}));
    var State = exports.State;
    // This function is basically a context check to protect against calling WritableStream methods with incorrect context
    // (as one might accidentally do when passing a method as callback)
    function isWritableStream(x) {
        return Object.prototype.hasOwnProperty.call(x, '_underlyingSink');
    }
    /**
     * This class provides a writable stream implementation. Data written to a stream will be passed on to the underlying
     * sink (`WritableStream.Sink`), an instance of which must be supplied to the stream upon instantation. This class
     * provides the standard stream API, while implementations of the `Sink` API allow the data to be written to
     * various persistence layers.
     */
    var WritableStream = (function () {
        function WritableStream(underlyingSink, strategy) {
            var _this = this;
            if (underlyingSink === void 0) { underlyingSink = {}; }
            if (strategy === void 0) { strategy = {}; }
            this._underlyingSink = underlyingSink;
            this._closedPromise = new Promise_1.default(function (resolve, reject) {
                _this._resolveClosedPromise = resolve;
                _this._rejectClosedPromise = reject;
            });
            this._advancing = false;
            this._readyPromise = Promise_1.default.resolve();
            this._queue = new SizeQueue_1.default();
            this._state = State.Writable;
            this._started = false;
            this._writing = false;
            this._strategy = util.normalizeStrategy(strategy);
            this._syncStateWithQueue();
            this._startedPromise = Promise_1.default.resolve(util.invokeOrNoop(this._underlyingSink, 'start', [this._error.bind(this)])).then(function () {
                _this._started = true;
                _this._startedPromise = undefined;
            }, function (error) {
                _this._error(error);
            });
        }
        Object.defineProperty(WritableStream.prototype, "closed", {
            /**
             * @returns A promise that is resolved when the stream is closed, or is rejected if the stream errors.
             */
            get: function () {
                return this._closedPromise;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(WritableStream.prototype, "ready", {
            /**
             * @returns A promise that is resolved when the stream transitions away from the 'waiting' state. The stream will
             * use this to indicate backpressure - an unresolved `ready` promise indicates that writes should not yet be
             * performed.
             */
            get: function () {
                return this._readyPromise;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(WritableStream.prototype, "state", {
            /**
             * @returns The stream's current @State
             */
            get: function () {
                return this._state;
            },
            enumerable: true,
            configurable: true
        });
        // This method combines the logic of two methods:
        // 4.3.1 CallOrScheduleWritableStreamAdvanceQueue
        // 4.3.6 WritableStreamAdvanceQueue
        WritableStream.prototype._advanceQueue = function () {
            var _this = this;
            if (!this._started) {
                if (!this._advancing) {
                    this._advancing = true;
                    this._startedPromise.then(function () {
                        _this._advanceQueue();
                    });
                }
                return;
            }
            if (!this._queue || this._writing) {
                return;
            }
            var writeRecord = this._queue.peek();
            if (writeRecord.close) {
                // TODO: SKIP? Assert 4.3.6-3.a
                if (this.state !== State.Closing) {
                    throw new Error('Invalid record');
                }
                this._queue.dequeue();
                // TODO: SKIP? Assert 4.3.6-3.c
                this._close();
                return;
            }
            this._writing = true;
            util.promiseInvokeOrNoop(this._underlyingSink, 'write', [writeRecord.chunk]).then(function () {
                if (_this.state !== State.Errored) {
                    _this._writing = false;
                    writeRecord.resolve();
                    _this._queue.dequeue();
                    try {
                        _this._syncStateWithQueue();
                    }
                    catch (error) {
                        return _this._error(error);
                    }
                    _this._advanceQueue();
                }
            }, function (error) {
                _this._error(error);
            });
        };
        // 4.3.2 CloseWritableStream
        WritableStream.prototype._close = function () {
            var _this = this;
            if (this.state !== State.Closing) {
                // 4.3.2-1
                throw new Error('WritableStream#_close called while state is not "Closing"');
            }
            util.promiseInvokeOrNoop(this._underlyingSink, 'close').then(function () {
                if (_this.state !== State.Errored) {
                    // TODO: Assert 4.3.2.2-a.ii
                    _this._resolveClosedPromise();
                    _this._state = State.Closed;
                    _this._underlyingSink = undefined;
                }
            }, function (error) {
                _this._error(error);
            });
        };
        // 4.3.3 ErrorWritableStream
        WritableStream.prototype._error = function (error) {
            if (this.state === State.Closed || this.state === State.Errored) {
                return;
            }
            var writeRecord;
            while (this._queue.length) {
                writeRecord = this._queue.dequeue();
                if (!writeRecord.close) {
                    writeRecord.reject(error);
                }
            }
            this._storedError = error;
            if (this.state === State.Waiting) {
                this._resolveReadyPromise();
            }
            this._rejectClosedPromise(error);
            this._state = State.Errored;
        };
        // 4.3.5 SyncWritableStreamStateWithQueue
        WritableStream.prototype._syncStateWithQueue = function () {
            var _this = this;
            if (this.state === State.Closing) {
                return;
            }
            var queueSize = this._queue.totalSize;
            var shouldApplyBackPressure = queueSize > this._strategy.highWaterMark;
            if (shouldApplyBackPressure && this.state === State.Writable) {
                this._state = State.Waiting;
                this._readyPromise = new Promise_1.default(function (resolve, reject) {
                    _this._resolveReadyPromise = resolve;
                    _this._rejectReadyPromise = reject;
                });
            }
            if (shouldApplyBackPressure === false && this.state === State.Waiting) {
                this._state = State.Writable;
                this._resolveReadyPromise();
            }
        };
        /**
         * Signals that the producer can no longer write to the stream and it should be immediately moved to an "errored"
         * state. Any un-written data that is queued will be discarded.
         */
        WritableStream.prototype.abort = function (reason) {
            // 4.2.4.4-1
            if (!isWritableStream(this)) {
                return Promise_1.default.reject(new Error('WritableStream method called in context of object that is not a WritableStream instance'));
            }
            if (this.state === State.Closed) {
                // 4.2.4.4-2
                return Promise_1.default.resolve();
            }
            if (this.state === State.Errored) {
                // 4.2.4.4-3
                return Promise_1.default.reject(this._storedError);
            }
            var error = reason instanceof Error ? reason : new Error(reason);
            this._error(error);
            return util.promiseInvokeOrFallbackOrNoop(this._underlyingSink, 'abort', [reason], 'close')
                .then(function () {
                return;
            });
        };
        /**
         * Signals that the producer is done writing to the stream and wishes to move it to a "closed" state. The stream
         * may have un-writted data queued; until the data has been written the stream will remain in the "closing" state.
         */
        WritableStream.prototype.close = function () {
            // 4.2.4.5-1
            if (!isWritableStream(this)) {
                return Promise_1.default.reject(new Error('WritableStream method called in context of object that is not a WritableStream instance'));
            }
            // 4.2.4.5-2
            if (this.state === State.Closed) {
                return Promise_1.default.reject(new TypeError('Stream is already closed'));
            }
            if (this.state === State.Closing) {
                return Promise_1.default.reject(new TypeError('Stream is already closing'));
            }
            if (this.state === State.Errored) {
                // 4.2.4.5-3
                return Promise_1.default.reject(this._storedError);
            }
            if (this.state === State.Waiting) {
                // 4.2.4.5-4
                this._resolveReadyPromise();
            }
            this._state = State.Closing;
            this._queue.enqueue({ close: true }, 0);
            this._advanceQueue();
            return this._closedPromise;
        };
        /**
         * Enqueue a chunk of data to be written to the underlying sink. `write` can be called successively without waiting
         * for the previous write's promise to resolve. To respect the stream's backpressure indicator, check if the stream
         * has entered the "waiting" state between writes.
         *
         * @returns A promise that will be fulfilled when the chunk has been written to the underlying sink.
         */
        WritableStream.prototype.write = function (chunk) {
            // 4.2.4.6-1
            if (!isWritableStream(this)) {
                return Promise_1.default.reject(new Error('WritableStream method called in context of object that is not a WritableStream instance'));
            }
            // 4.2.4.6-2
            if (this.state === State.Closed) {
                return Promise_1.default.reject(new TypeError('Stream is closed'));
            }
            if (this.state === State.Closing) {
                return Promise_1.default.reject(new TypeError('Stream is closing'));
            }
            if (this.state === State.Errored) {
                // 4.2.4.6-3
                return Promise_1.default.reject(this._storedError);
            }
            var chunkSize = 1;
            var writeRecord;
            var promise = new Promise_1.default(function (resolve, reject) {
                writeRecord = {
                    chunk: chunk,
                    reject: reject,
                    resolve: resolve
                };
            });
            // 4.2.4.6-6.b
            try {
                if (this._strategy && this._strategy.size) {
                    chunkSize = this._strategy.size(chunk);
                }
                this._queue.enqueue(writeRecord, chunkSize);
                this._syncStateWithQueue();
            }
            catch (error) {
                // 4.2.4.6-6.b, 4.2.4.6-10, 4.2.4.6-12
                this._error(error);
                return Promise_1.default.reject(error);
            }
            this._advanceQueue();
            return promise;
        };
        return WritableStream;
    }());
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.default = WritableStream;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV3JpdGFibGVTdHJlYW0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc3RyZWFtcy9Xcml0YWJsZVN0cmVhbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7SUFDQSx3QkFBb0IsWUFBWSxDQUFDLENBQUE7SUFDakMsMEJBQXNCLGFBQWEsQ0FBQyxDQUFBO0lBQ3BDLElBQVksSUFBSSxXQUFNLFFBQVEsQ0FBQyxDQUFBO0lBWS9COztPQUVHO0lBQ0gsV0FBWSxLQUFLO1FBQUcscUNBQU0sQ0FBQTtRQUFFLHVDQUFPLENBQUE7UUFBRSx1Q0FBTyxDQUFBO1FBQUUsdUNBQU8sQ0FBQTtRQUFFLHlDQUFRLENBQUE7SUFBQyxDQUFDLEVBQXJELGFBQUssS0FBTCxhQUFLLFFBQWdEO0lBQWpFLElBQVksS0FBSyxHQUFMLGFBQXFELENBQUE7SUFFakUsc0hBQXNIO0lBQ3RILG1FQUFtRTtJQUNuRSwwQkFBMEIsQ0FBTTtRQUMvQixNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0lBQ25FLENBQUM7SUE0Q0Q7Ozs7O09BS0c7SUFDSDtRQXdDQyx3QkFBWSxjQUE0QixFQUFFLFFBQTBCO1lBeENyRSxpQkErVEM7WUF2UlksOEJBQTRCLEdBQTVCLG1CQUE0QjtZQUFFLHdCQUEwQixHQUExQixhQUEwQjtZQUNuRSxJQUFJLENBQUMsZUFBZSxHQUFHLGNBQWMsQ0FBQztZQUV0QyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksaUJBQU8sQ0FBTyxVQUFDLE9BQU8sRUFBRSxNQUFNO2dCQUN2RCxLQUFJLENBQUMscUJBQXFCLEdBQUcsT0FBTyxDQUFDO2dCQUNyQyxLQUFJLENBQUMsb0JBQW9CLEdBQUcsTUFBTSxDQUFDO1lBQ3BDLENBQUMsQ0FBQyxDQUFDO1lBRUgsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7WUFDeEIsSUFBSSxD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LE9BQU8sQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUM7Z0JBQzVDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1lBQzVCLENBQ0E7WUFBQSxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNkLHNDQUFzQztnQkFDdEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDbkIsTUFBTSxDQUFDLGlCQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlCLENBQUM7WUFFRCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFFckIsTUFBTSxDQUFDLE9BQU8sQ0FBQztRQUNoQixDQUFDO1FBQ0YscUJBQUM7SUFBRCxDQUFDLEFBL1RELElBK1RDO0lBL1REO29DQStUQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3RyYXRlZ3kgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xuaW1wb3J0IFByb21pc2UgZnJvbSAnLi4vUHJvbWlzZSc7XG5pbXBvcnQgU2l6ZVF1ZXVlIGZyb20gJy4vU2l6ZVF1ZXVlJztcbmltcG9ydCAqIGFzIHV0aWwgZnJvbSAnLi91dGlsJztcblxuLy8gQSBSZWNvcmQgaXMgdXNlZCBpbnRlcm5hbGx5IGJ5IHRoZSBzdHJlYW0gdG8gcHJvY2VzcyBxdWV1ZWQgd3JpdGVzLiBJdCByZXByZXNlbnRzIHRoZSBjaHVuayB0byBiZSB3cml0dGVuIHBsdXNcbi8vIGFkZGl0aW9uYWwgbWV0YWRhdGEgdXNlZCBpbnRlcm5hbGx5LlxuZXhwb3J0IGludGVyZmFjZSBSZWNvcmQ8VD4ge1xuXHQvLyBUaGlzIGZsYWcgaW5kaWNhdGVzIHRoYXQgdGhpcyByZWNvcmQgaXMgdGhlIGVuZCBvZiB0aGUgc3RyZWFtIGFuZCB0aGUgc3RyZWFtIHNob3VsZCBjbG9zZSB3aGVuIHByb2Nlc3NpbmcgaXRcblx0Y2xvc2U/OiBib29sZWFuO1xuXHRjaHVuaz86IFQ7XG5cdHJlamVjdD86IChlcnJvcjogRXJyb3IpID0+IHZvaWQ7XG5cdHJlc29sdmU/OiAoKSA9PiB2b2lkO1xufVxuXG4vKipcbiAqIFdyaXRhYmxlU3RyZWFtJ3MgcG9zc2libGUgc3RhdGVzXG4gKi9cbmV4cG9ydCBlbnVtIFN0YXRlIHsgQ2xvc2VkLCBDbG9zaW5nLCBFcnJvcmVkLCBXYWl0aW5nLCBXcml0YWJsZSB9XG5cbi8vIFRoaXMgZnVuY3Rpb24gaXMgYmFzaWNhbGx5IGEgY29udGV4dCBjaGVjayB0byBwcm90ZWN0IGFnYWluc3QgY2FsbGluZyBXcml0YWJsZVN0cmVhbSBtZXRob2RzIHdpdGggaW5jb3JyZWN0IGNvbnRleHRcbi8vIChhcyBvbmUgbWlnaHQgYWNjaWRlbnRhbGx5IGRvIHdoZW4gcGFzc2luZyBhIG1ldGhvZCBhcyBjYWxsYmFjaylcbmZ1bmN0aW9uIGlzV3JpdGFibGVTdHJlYW0oeDogYW55KTogYm9vbGVhbiB7XG5cdHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ191bmRlcmx5aW5nU2luaycpO1xufVxuXG4vKipcbiAqIFRoZSBTaW5rIGludGVyZmFjZSBkZWZpbmVzIHRoZSBtZXRob2RzIGEgbW9kdWxlIGNhbiBpbXBsZW1lbnQgdG8gY3JlYXRlIGEgdGFyZ2V0IHNpbmsgZm9yIGEgYFdyaXRhYmxlU3RyZWFtYC5cbiAqXG4gKiBUaGUgU3RyZWFtIEFQSSBwcm92aWRlcyBhIGNvbnNpc3RlbnQgc3RyZWFtIEFQSSB3aGlsZSBgUmVhZGFibGVTdHJlYW0uU291cmNlYCBhbmQgYFdyaXRhYmxlU3RyZWFtLlNpbmtgIGltcGxlbWVudG9yc1xuICogcHJvdmlkZSB0aGUgbG9naWMgdG8gY29ubmVjdCBhIHN0cmVhbSB0byBzcGVjaWZpYyBkYXRhIHNvdXJjZXMgJiBzaW5rcy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTaW5rPFQ+IHtcblxuXHQvKipcblx0ICogSW5kaWNhdGVzIHRoZSBzdHJlYW0gaXMgcHJlbWF0dXJlbHkgY2xvc2luZyBkdWUgdG8gYW4gZXJyb3IuICBUaGUgc2luayBzaG91bGQgZG8gYW55IG5lY2Vzc2FyeSBjbGVhbnVwXG5cdCAqIGFuZCByZWxlYXNlIHJlc291cmNlcy4gV2hlbiBhIHN0cmVhbSBjYWxscyBgYWJvcnRgIGl0IHdpbGwgZGlzY2FyZCBhbnkgcXVldWVkIGNodW5rcy4gSWYgdGhlIHNpbmsgZG9lcyBub3Rcblx0ICogcHJvdmlkZSBhbiBgYWJvcnRgIG1ldGhvZCB0aGVuIHRoZSBzdHJlYW0gd2lsbCBjYWxsIGBjbG9zZWAgaW5zdGVhZC5cblx0ICpcblx0ICogQHBhcmFtIHJlYXNvbiBUaGUgcmVhc29uIHRoZSBzdHJlYW0gaXMgY2xvc2luZy5cblx0ICovXG5cdGFib3J0PyhyZWFzb24/OiBhbnkpOiBQcm9taXNlPHZvaWQ+O1xuXG5cdC8qKlxuXHQgKiBJbmRpY2F0ZXMgdGhlIHN0cmVhbSBpcyBjbG9zaW5nLiAgVGhlIHNpbmsgc2hvdWxkIGRvIGFueSBuZWNlc3NhcnkgY2xlYW51cCBhbmQgcmVsZWFzZSByZXNvdXJjZXMuIFRoZSBzdHJlYW1cblx0ICogd2lsbCBub3QgY2FsbCB0aGlzIG1ldGhvZCB1bnRpbCBpcyBoYXMgc3VjY2Vzc2Z1bGx5IHdyaXR0ZW4gYWxsIHF1ZXVlZCBjaHVua3MuXG5cdCAqL1xuXHRjbG9zZT8oKTogUHJvbWlzZTx2b2lkPjtcblxuXHQvKipcblx0ICogUmVxdWVzdHMgdGhlIHNpbmsgdG8gcHJlcGFyZSBmb3IgcmVjZWl2aW5nIGNodW5rcy5cblx0ICpcblx0ICogQHBhcmFtIGVycm9yIEFuIGVycm9yIGNhbGxiYWNrIHRoYXQgY2FuIGJlIHVzZWQgYXQgYW55IHRpbWUgYnkgdGhlIHNpbmsgdG8gaW5kaWNhdGUgYW4gZXJyb3IgaGFzIG9jY3VycmVkLlxuXHQgKiBAcmV0dXJucyBBIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBzaW5rJ3Mgc3RhcnQgb3BlcmF0aW9uIGhhcyBmaW5pc2hlZC4gIElmIHRoZSBwcm9taXNlIHJlamVjdHMsXG5cdCAqIFx0XHR0aGUgc3RyZWFtIHdpbGwgYmUgZXJyb3JlZC5cblx0ICovXG5cdHN0YXJ0PyhlcnJvcjogKGVycm9yOiBFcnJvcikgPT4gdm9pZCk6IFByb21pc2U8dm9pZD47XG5cblx0LyoqXG5cdCAqIFJlcXVlc3RzIHRoZSBzaW5rIHdyaXRlIGEgY2h1bmsuXG5cdCAqXG5cdCAqIEBwYXJhbSBjaHVuayBUaGUgY2h1bmsgdG8gYmUgd3JpdHRlbi5cblx0ICogQHJldHVybnMgQSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgc2luaydzIHdyaXRlIG9wZXJhdGlvbiBoYXMgZmluaXNoZWQuICBJZiB0aGUgcHJvbWlzZSByZWplY3RzLFxuXHQgKiBcdFx0dGhlIHN0cmVhbSB3aWxsIGJlIGVycm9yZWQuXG5cdCAqL1xuXHR3cml0ZT8oY2h1bms6IFQpOiBQcm9taXNlPHZvaWQ+O1xufVxuXG4vKipcbiAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgYSB3cml0YWJsZSBzdHJlYW0gaW1wbGVtZW50YXRpb24uIERhdGEgd3JpdHRlbiB0byBhIHN0cmVhbSB3aWxsIGJlIHBhc3NlZCBvbiB0byB0aGUgdW5kZXJseWluZ1xuICogc2luayAoYFdyaXRhYmxlU3RyZWFtLlNpbmtgKSwgYW4gaW5zdGFuY2Ugb2Ygd2hpY2ggbXVzdCBiZSBzdXBwbGllZCB0byB0aGUgc3RyZWFtIHVwb24gaW5zdGFudGF0aW9uLiBUaGlzIGNsYXNzXG4gKiBwcm92aWRlcyB0aGUgc3RhbmRhcmQgc3RyZWFtIEFQSSwgd2hpbGUgaW1wbGVtZW50YXRpb25zIG9mIHRoZSBgU2lua2AgQVBJIGFsbG93IHRoZSBkYXRhIHRvIGJlIHdyaXR0ZW4gdG9cbiAqIHZhcmlvdXMgcGVyc2lzdGVuY2UgbGF5ZXJzLlxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXcml0YWJsZVN0cmVhbTxUPiB7XG5cdC8qKlxuXHQgKiBAcmV0dXJucyBBIHByb21pc2UgdGhhdCBpcyByZXNvbHZlZCB3aGVuIHRoZSBzdHJlYW0gaXMgY2xvc2VkLCBvciBpcyByZWplY3RlZCBpZiB0aGUgc3RyZWFtIGVycm9ycy5cblx0ICovXG5cdGdldCBjbG9zZWQoKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0cmV0dXJuIHRoaXMuX2Nsb3NlZFByb21pc2U7XG5cdH1cblxuXHQvKipcblx0ICogQHJldHVybnMgQSBwcm9taXNlIHRoYXQgaXMgcmVzb2x2ZWQgd2hlbiB0aGUgc3RyZWFtIHRyYW5zaXRpb25zIGF3YXkgZnJvbSB0aGUgJ3dhaXRpbmcnIHN0YXRlLiBUaGUgc3RyZWFtIHdpbGxcblx0ICogdXNlIHRoaXMgdG8gaW5kaWNhdGUgYmFja3ByZXNzdXJlIC0gYW4gdW5yZXNvbHZlZCBgcmVhZHlgIHByb21pc2UgaW5kaWNhdGVzIHRoYXQgd3JpdGVzIHNob3VsZCBub3QgeWV0IGJlXG5cdCAqIHBlcmZvcm1lZC5cblx0ICovXG5cdGdldCByZWFkeSgpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRyZXR1cm4gdGhpcy5fcmVhZHlQcm9taXNlO1xuXHR9XG5cblx0LyoqXG5cdCAqIEByZXR1cm5zIFRoZSBzdHJlYW0ncyBjdXJyZW50IEBTdGF0ZVxuXHQgKi9cblx0Z2V0IHN0YXRlKCk6IFN0YXRlIHtcblx0XHRyZXR1cm4gdGhpcy5fc3RhdGU7XG5cdH1cblxuXHRwcm90ZWN0ZWQgX2FkdmFuY2luZzogYm9vbGVhbjtcblx0cHJvdGVjdGVkIF9jbG9zZWRQcm9taXNlOiBQcm9taXNlPHZvaWQ+O1xuXHRwcm90ZWN0ZWQgX3JlYWR5UHJvbWlzZTogUHJvbWlzZTx2b2lkPjtcblx0cHJvdGVjdGVkIF9yZWplY3RDbG9zZWRQcm9taXNlOiAoZXJyb3I6IEVycm9yKSA9PiB2b2lkO1xuXHRwcm90ZWN0ZWQgX3JlamVjdFJlYWR5UHJvbWlzZTogKGVycm9yOiBFcnJvcikgPT4gdm9pZDtcblx0cHJvdGVjdGVkIF9yZXNvbHZlQ2xvc2VkUHJvbWlzZTogKCkgPT4gdm9pZDtcblx0cHJvdGVjdGVkIF9yZXNvbHZlUmVhZHlQcm9taXNlOiAoKSA9PiB2b2lkO1xuXHRwcm90ZWN0ZWQgX3N0YXJ0ZWQ6IGJvb2xlYW47XG5cdHByb3RlY3RlZCBfc3RhcnRlZFByb21pc2U6IFByb21pc2U8YW55Pjtcblx0cHJvdGVjdGVkIF9zdGF0ZTogU3RhdGU7XG5cdHByb3RlY3RlZCBfc3RvcmVkRXJyb3I6IEVycm9yO1xuXHRwcm90ZWN0ZWQgX3N0cmF0ZWd5OiBTdHJhdGVneTxUPjtcblx0cHJvdGVjdGVkIF91bmRlcmx5aW5nU2luazogU2luazxUPjtcblx0cHJvdGVjdGVkIF9xdWV1ZTogU2l6ZVF1ZXVlPFJlY29yZDxUPj47XG5cdHByb3RlY3RlZCBfd3JpdGluZzogYm9vbGVhbjtcblxuXHRjb25zdHJ1Y3Rvcih1bmRlcmx5aW5nU2luazogU2luazxUPiA9IHt9LCBzdHJhdGVneTogU3RyYXRlZ3k8VD4gPSB7fSkge1xuXHRcdHRoaXMuX3VuZGVybHlpbmdTaW5rID0gdW5kZXJseWluZ1Npbms7XG5cblx0XHR0aGlzLl9jbG9zZWRQcm9taXNlID0gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0dGhpcy5fcmVzb2x2ZUNsb3NlZFByb21pc2UgPSByZXNvbHZlO1xuXHRcdFx0dGhpcy5fcmVqZWN0Q2xvc2VkUHJvbWlzZSA9IHJlamVjdDtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2FkdmFuY2luZyA9IGZhbHNlO1xuXHRcdHRoaXMuX3JlYWR5UHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSgpO1xuXHRcdHRoaXMuX3F1ZXVlID0gbmV3IFNpemVRdWV1ZTxSZWNvcmQ8VD4+KCk7XG5cdFx0dGhpcy5fc3RhdGUgPSBTdGF0ZS5Xcml0YWJsZTtcblx0XHR0aGlzLl9zdGFydGVkID0gZmFsc2U7XG5cdFx0dGhpcy5fd3JpdGluZyA9IGZhbHNlO1xuXHRcdHRoaXMuX3N0cmF0ZWd5ID0gdXRpbC5ub3JtYWxpemVTdHJhdGVneShzdHJhdGVneSk7XG5cdFx0dGhpcy5fc3luY1N0YXRlV2l0aFF1ZXVlKCk7XG5cblx0XHR0aGlzLl9zdGFydGVkUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZShcblx0XHRcdHV0aWwuaW52b2tlT3JOb29wKHRoaXMuX3VuZGVybHlpbmdTaW5rLCAnc3RhcnQnLCBbIHRoaXMuX2Vycm9yLmJpbmQodGhpcykgXSlcblx0XHQpLnRoZW4oKCkgPT4ge1xuXHRcdFx0dGhpcy5fc3RhcnRlZCA9IHRydWU7XG5cdFx0XHR0aGlzLl9zdGFydGVkUHJvbWlzZSA9IHVuZGVmaW5lZDtcblx0XHR9LCAoZXJyb3I6IEVycm9yKSA9PiB7XG5cdFx0XHR0aGlzLl9lcnJvcihlcnJvcik7XG5cdFx0fSk7XG5cdH1cblxuXHQvLyBUaGlzIG1ldGhvZCBjb21iaW5lcyB0aGUgbG9naWMgb2YgdHdvIG1ldGhvZHM6XG5cdC8vIDQuMy4xIENhbGxPclNjaGVkdWxlV3JpdGFibGVTdHJlYW1BZHZhbmNlUXVldWVcblx0Ly8gNC4zLjYgV3JpdGFibGVTdHJlYW1BZHZhbmNlUXVldWVcblx0cHJvdGVjdGVkIF9hZHZhbmNlUXVldWUoKSB7XG5cdFx0aWYgKCF0aGlzLl9zdGFydGVkKSB7XG5cdFx0XHRpZiAoIXRoaXMuX2FkdmFuY2luZykge1xuXHRcdFx0XHR0aGlzLl9hZHZhbmNpbmcgPSB0cnVlO1xuXHRcdFx0XHR0aGlzLl9zdGFydGVkUHJvbWlzZS50aGVuKCgpID0+IHtcblx0XHRcdFx0XHR0aGlzLl9hZHZhbmNlUXVldWUoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXVlIHx8IHRoaXMuX3dyaXRpbmcpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRjb25zdCB3cml0ZVJlY29yZDogUmVjb3JkPFQ+ID0gdGhpcy5fcXVldWUucGVlaygpO1xuXG5cdFx0aWYgKHdyaXRlUmVjb3JkLmNsb3NlKSB7XG5cdFx0XHQvLyBUT0RPOiBTS0lQPyBBc3NlcnQgNC4zLjYtMy5hXG5cdFx0XHRpZiAodGhpcy5zdGF0ZSAhPT0gU3RhdGUuQ2xvc2luZykge1xuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcmVjb3JkJyk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuX3F1ZXVlLmRlcXVldWUoKTtcblx0XHRcdC8vIFRPRE86IFNLSVA/IEFzc2VydCA0LjMuNi0zLmNcblx0XHRcdHRoaXMuX2Nsb3NlKCk7XG5cblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR0aGlzLl93cml0aW5nID0gdHJ1ZTtcblxuXHRcdHV0aWwucHJvbWlzZUludm9rZU9yTm9vcCh0aGlzLl91bmRlcmx5aW5nU2luaywgJ3dyaXRlJywgWyB3cml0ZVJlY29yZC5jaHVuayBdKS50aGVuKCgpID0+IHtcblx0XHRcdGlmICh0aGlzLnN0YXRlICE9PSBTdGF0ZS5FcnJvcmVkKSB7XG5cdFx0XHRcdHRoaXMuX3dyaXRpbmcgPSBmYWxzZTtcblx0XHRcdFx0d3JpdGVSZWNvcmQucmVzb2x2ZSgpO1xuXHRcdFx0XHR0aGlzLl9xdWV1ZS5kZXF1ZXVlKCk7XG5cblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHR0aGlzLl9zeW5jU3RhdGVXaXRoUXVldWUoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRjYXRjaCAoZXJyb3IpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZXJyb3IoZXJyb3IpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5fYWR2YW5jZVF1ZXVlKCk7XG5cdFx0XHR9XG5cdFx0fSwgKGVycm9yOiBFcnJvcikgPT4ge1xuXHRcdFx0dGhpcy5fZXJyb3IoZXJyb3IpO1xuXHRcdH0pO1xuXHR9XG5cblx0Ly8gNC4zLjIgQ2xvc2VXcml0YWJsZVN0cmVhbVxuXHRwcm90ZWN0ZWQgX2Nsb3NlKCk6IHZvaWQge1xuXHRcdGlmICh0aGlzLnN0YXRlICE9PSBTdGF0ZS5DbG9zaW5nKSB7XG5cdFx0XHQvLyA0LjMuMi0xXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ1dyaXRhYmxlU3RyZWFtI19jbG9zZSBjYWxsZWQgd2hpbGUgc3RhdGUgaXMgbm90IFwiQ2xvc2luZ1wiJyk7XG5cdFx0fVxuXG5cdFx0dXRpbC5wcm9taXNlSW52b2tlT3JOb29wKHRoaXMuX3VuZGVybHlpbmdTaW5rLCAnY2xvc2UnKS50aGVuKCgpID0+IHtcblx0XHRcdGlmICh0aGlzLnN0YXRlICE9PSBTdGF0ZS5FcnJvcmVkKSB7XG5cdFx0XHRcdC8vIFRPRE86IEFzc2VydCA0LjMuMi4yLWEuaWlcblx0XHRcdFx0dGhpcy5fcmVzb2x2ZUNsb3NlZFByb21pc2UoKTtcblx0XHRcdFx0dGhpcy5fc3RhdGUgPSBTdGF0ZS5DbG9zZWQ7XG5cdFx0XHRcdHRoaXMuX3VuZGVybHlpbmdTaW5rID0gdW5kZWZpbmVkO1xuXHRcdFx0fVxuXHRcdH0sIChlcnJvcjogRXJyb3IpID0+IHtcblx0XHRcdHRoaXMuX2Vycm9yKGVycm9yKTtcblx0XHR9KTtcblx0fVxuXG5cdC8vIDQuMy4zIEVycm9yV3JpdGFibGVTdHJlYW1cblx0cHJvdGVjdGVkIF9lcnJvcihlcnJvcjogRXJyb3IpIHtcblx0XHRpZiAodGhpcy5zdGF0ZSA9PT0gU3RhdGUuQ2xvc2VkIHx8IHRoaXMuc3RhdGUgPT09IFN0YXRlLkVycm9yZWQpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRsZXQgd3JpdGVSZWNvcmQ6IFJlY29yZDxUPjtcblxuXHRcdHdoaWxlICh0aGlzLl9xdWV1ZS5sZW5ndGgpIHtcblx0XHRcdHdyaXRlUmVjb3JkID0gdGhpcy5fcXVldWUuZGVxdWV1ZSgpO1xuXG5cdFx0XHRpZiAoIXdyaXRlUmVjb3JkLmNsb3NlKSB7XG5cdFx0XHRcdHdyaXRlUmVjb3JkLnJlamVjdChlcnJvcik7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGhpcy5fc3RvcmVkRXJyb3IgPSBlcnJvcjtcblxuXHRcdGlmICh0aGlzLnN0YXRlID09PSBTdGF0ZS5XYWl0aW5nKSB7XG5cdFx0XHR0aGlzLl9yZXNvbHZlUmVhZHlQcm9taXNlKCk7XG5cdFx0fVxuXG5cdFx0dGhpcy5fcmVqZWN0Q2xvc2VkUHJvbWlzZShlcnJvcik7XG5cdFx0dGhpcy5fc3RhdGUgPSBTdGF0ZS5FcnJvcmVkO1xuXHR9XG5cblx0Ly8gNC4zLjUgU3luY1dyaXRhYmxlU3RyZWFtU3RhdGVXaXRoUXVldWVcblx0cHJvdGVjdGVkIF9zeW5jU3RhdGVXaXRoUXVldWUoKTogdm9pZCB7XG5cdFx0aWYgKHRoaXMuc3RhdGUgPT09IFN0YXRlLkNsb3NpbmcpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRjb25zdCBxdWV1ZVNpemUgPSB0aGlzLl9xdWV1ZS50b3RhbFNpemU7XG5cdFx0Y29uc3Qgc2hvdWxkQXBwbHlCYWNrUHJlc3N1cmUgPSBxdWV1ZVNpemUgPiB0aGlzLl9zdHJhdGVneS5oaWdoV2F0ZXJNYXJrO1xuXG5cdFx0aWYgKHNob3VsZEFwcGx5QmFja1ByZXNzdXJlICYmIHRoaXMuc3RhdGUgPT09IFN0YXRlLldyaXRhYmxlKSB7XG5cdFx0XHR0aGlzLl9zdGF0ZSA9IFN0YXRlLldhaXRpbmc7XG5cdFx0XHR0aGlzLl9yZWFkeVByb21pc2UgPSBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRcdHRoaXMuX3Jlc29sdmVSZWFkeVByb21pc2UgPSByZXNvbHZlO1xuXHRcdFx0XHR0aGlzLl9yZWplY3RSZWFkeVByb21pc2UgPSByZWplY3Q7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2hvdWxkQXBwbHlCYWNrUHJlc3N1cmUgPT09IGZhbHNlICYmIHRoaXMuc3RhdGUgPT09IFN0YXRlLldhaXRpbmcpIHtcblx0XHRcdHRoaXMuX3N0YXRlID0gU3RhdGUuV3JpdGFibGU7XG5cdFx0XHR0aGlzLl9yZXNvbHZlUmVhZHlQcm9taXNlKCk7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIFNpZ25hbHMgdGhhdCB0aGUgcHJvZHVjZXIgY2FuIG5vIGxvbmdlciB3cml0ZSB0byB0aGUgc3RyZWFtIGFuZCBpdCBzaG91bGQgYmUgaW1tZWRpYXRlbHkgbW92ZWQgdG8gYW4gXCJlcnJvcmVkXCJcblx0ICogc3RhdGUuIEFueSB1bi13cml0dGVuIGRhdGEgdGhhdCBpcyBxdWV1ZWQgd2lsbCBiZSBkaXNjYXJkZWQuXG5cdCAqL1xuXHRhYm9ydChyZWFzb246IGFueSk6IFByb21pc2U8dm9pZD4ge1xuXHRcdC8vIDQuMi40LjQtMVxuXHRcdGlmICghaXNXcml0YWJsZVN0cmVhbSh0aGlzKSkge1xuXHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KFxuXHRcdFx0XHRuZXcgRXJyb3IoJ1dyaXRhYmxlU3RyZWFtIG1ldGhvZCBjYWxsZWQgaW4gY29udGV4dCBvZiBvYmplY3QgdGhhdCBpcyBub3QgYSBXcml0YWJsZVN0cmVhbSBpbnN0YW5jZScpXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnN0YXRlID09PSBTdGF0ZS5DbG9zZWQpIHtcblx0XHRcdC8vIDQuMi40LjQtMlxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnN0YXRlID09PSBTdGF0ZS5FcnJvcmVkKSB7XG5cdFx0XHQvLyA0LjIuNC40LTNcblx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdCh0aGlzLl9zdG9yZWRFcnJvcik7XG5cdFx0fVxuXG5cdFx0Y29uc3QgZXJyb3I6IEVycm9yID0gcmVhc29uIGluc3RhbmNlb2YgRXJyb3IgPyByZWFzb24gOiBuZXcgRXJyb3IocmVhc29uKTtcblxuXHRcdHRoaXMuX2Vycm9yKGVycm9yKTtcblxuXHRcdHJldHVybiB1dGlsLnByb21pc2VJbnZva2VPckZhbGxiYWNrT3JOb29wKHRoaXMuX3VuZGVybHlpbmdTaW5rLCAnYWJvcnQnLCBbIHJlYXNvbiBdLCAnY2xvc2UnKVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBTaWduYWxzIHRoYXQgdGhlIHByb2R1Y2VyIGlzIGRvbmUgd3JpdGluZyB0byB0aGUgc3RyZWFtIGFuZCB3aXNoZXMgdG8gbW92ZSBpdCB0byBhIFwiY2xvc2VkXCIgc3RhdGUuIFRoZSBzdHJlYW1cblx0ICogbWF5IGhhdmUgdW4td3JpdHRlZCBkYXRhIHF1ZXVlZDsgdW50aWwgdGhlIGRhdGEgaGFzIGJlZW4gd3JpdHRlbiB0aGUgc3RyZWFtIHdpbGwgcmVtYWluIGluIHRoZSBcImNsb3NpbmdcIiBzdGF0ZS5cblx0ICovXG5cdGNsb3NlKCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdC8vIDQuMi40LjUtMVxuXHRcdGlmICghaXNXcml0YWJsZVN0cmVhbSh0aGlzKSkge1xuXHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KFxuXHRcdFx0XHRuZXcgRXJyb3IoJ1dyaXRhYmxlU3RyZWFtIG1ldGhvZCBjYWxsZWQgaW4gY29udGV4dCBvZiBvYmplY3QgdGhhdCBpcyBub3QgYSBXcml0YWJsZVN0cmVhbSBpbnN0YW5jZScpXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIDQuMi40LjUtMlxuXHRcdGlmICh0aGlzLnN0YXRlID09PSBTdGF0ZS5DbG9zZWQpIHtcblx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgVHlwZUVycm9yKCdTdHJlYW0gaXMgYWxyZWFkeSBjbG9zZWQnKSk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuc3RhdGUgPT09IFN0YXRlLkNsb3NpbmcpIHtcblx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgVHlwZUVycm9yKCdTdHJlYW0gaXMgYWxyZWFkeSBjbG9zaW5nJykpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnN0YXRlID09PSBTdGF0ZS5FcnJvcmVkKSB7XG5cdFx0XHQvLyA0LjIuNC41LTNcblx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdCh0aGlzLl9zdG9yZWRFcnJvcik7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuc3RhdGUgPT09IFN0YXRlLldhaXRpbmcpIHtcblx0XHRcdC8vIDQuMi40LjUtNFxuXHRcdFx0dGhpcy5fcmVzb2x2ZVJlYWR5UHJvbWlzZSgpO1xuXHRcdH1cblxuXHRcdHRoaXMuX3N0YXRlID0gU3RhdGUuQ2xvc2luZztcblx0XHR0aGlzLl9xdWV1ZS5lbnF1ZXVlKHsgY2xvc2U6IHRydWUgfSwgMCk7XG5cdFx0dGhpcy5fYWR2YW5jZVF1ZXVlKCk7XG5cblx0XHRyZXR1cm4gdGhpcy5fY2xvc2VkUHJvbWlzZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBFbnF1ZXVlIGEgY2h1bmsgb2YgZGF0YSB0byBiZSB3cml0dGVuIHRvIHRoZSB1bmRlcmx5aW5nIHNpbmsuIGB3cml0ZWAgY2FuIGJlIGNhbGxlZCBzdWNjZXNzaXZlbHkgd2l0aG91dCB3YWl0aW5nXG5cdCAqIGZvciB0aGUgcHJldmlvdXMgd3JpdGUncyBwcm9taXNlIHRvIHJlc29sdmUuIFRvIHJlc3BlY3QgdGhlIHN0cmVhbSdzIGJhY2twcmVzc3VyZSBpbmRpY2F0b3IsIGNoZWNrIGlmIHRoZSBzdHJlYW1cblx0ICogaGFzIGVudGVyZWQgdGhlIFwid2FpdGluZ1wiIHN0YXRlIGJldHdlZW4gd3JpdGVzLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBBIHByb21pc2UgdGhhdCB3aWxsIGJlIGZ1bGZpbGxlZCB3aGVuIHRoZSBjaHVuayBoYXMgYmVlbiB3cml0dGVuIHRvIHRoZSB1bmRlcmx5aW5nIHNpbmsuXG5cdCAqL1xuXHR3cml0ZShjaHVuazogVCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdC8vIDQuMi40LjYtMVxuXHRcdGlmICghaXNXcml0YWJsZVN0cmVhbSh0aGlzKSkge1xuXHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KFxuXHRcdFx0XHRuZXcgRXJyb3IoJ1dyaXRhYmxlU3RyZWFtIG1ldGhvZCBjYWxsZWQgaW4gY29udGV4dCBvZiBvYmplY3QgdGhhdCBpcyBub3QgYSBXcml0YWJsZVN0cmVhbSBpbnN0YW5jZScpXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdC8vIDQuMi40LjYtMlxuXHRcdGlmICh0aGlzLnN0YXRlID09PSBTdGF0ZS5DbG9zZWQpIHtcblx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgVHlwZUVycm9yKCdTdHJlYW0gaXMgY2xvc2VkJykpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnN0YXRlID09PSBTdGF0ZS5DbG9zaW5nKSB7XG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFR5cGVFcnJvcignU3RyZWFtIGlzIGNsb3NpbmcnKSk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuc3RhdGUgPT09IFN0YXRlLkVycm9yZWQpIHtcblx0XHRcdC8vIDQuMi40LjYtM1xuXHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KHRoaXMuX3N0b3JlZEVycm9yKTtcblx0XHR9XG5cblx0XHRsZXQgY2h1bmtTaXplID0gMTtcblx0XHRsZXQgd3JpdGVSZWNvcmQ6IFJlY29yZDxUPjtcblx0XHRsZXQgcHJvbWlzZSA9IG5ldyBQcm9taXNlPHZvaWQ+KGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblx0XHRcdHdyaXRlUmVjb3JkID0ge1xuXHRcdFx0XHRjaHVuazogY2h1bmssXG5cdFx0XHRcdHJlamVjdDogcmVqZWN0LFxuXHRcdFx0XHRyZXNvbHZlOiByZXNvbHZlXG5cdFx0XHR9O1xuXHRcdH0pO1xuXG5cdFx0Ly8gNC4yLjQuNi02LmJcblx0XHR0cnkge1xuXHRcdFx0aWYgKHRoaXMuX3N0cmF0ZWd5ICYmIHRoaXMuX3N0cmF0ZWd5LnNpemUpIHtcblx0XHRcdFx0Y2h1bmtTaXplID0gdGhpcy5fc3RyYXRlZ3kuc2l6ZShjaHVuayk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuX3F1ZXVlLmVucXVldWUod3JpdGVSZWNvcmQsIGNodW5rU2l6ZSk7XG5cdFx0XHR0aGlzLl9zeW5jU3RhdGVXaXRoUXVldWUoKTtcblx0XHR9XG5cdFx0Y2F0Y2ggKGVycm9yKSB7XG5cdFx0XHQvLyA0LjIuNC42LTYuYiwgNC4yLjQuNi0xMCwgNC4yLjQuNi0xMlxuXHRcdFx0dGhpcy5fZXJyb3IoZXJyb3IpO1xuXHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcblx0XHR9XG5cblx0XHR0aGlzLl9hZHZhbmNlUXVldWUoKTtcblxuXHRcdHJldHVybiBwcm9taXNlO1xuXHR9XG59XG4iXX0=