(function (factory) {
    if (typeof module === 'object' && typeof module.exports === 'object') {
        var v = factory(require, exports); if (v !== undefined) module.exports = v;
    }
    else if (typeof define === 'function' && define.amd) {
        define(["require", "exports", 'dojo-compose/compose', 'dojo-core/Promise', 'dojo-core/WeakMap'], factory);
    }
})(function (require, exports) {
    "use strict";
    var compose_1 = require('dojo-compose/compose');
    var Promise_1 = require('dojo-core/Promise');
    var WeakMap_1 = require('dojo-core/WeakMap');
    var handlesWeakMap = new WeakMap_1.default();
    var noop = function () { return Promise_1.default.resolve(false); };
    var destroyed = function () {
        throw new Error('Call made to destroyed method');
    };
    function isDestroyable(value) {
        return value && 'destroy' in value && typeof value.destroy === 'function';
    }
    exports.isDestroyable = isDestroyable;
    var createDestroyable = compose_1.default({
        own: function (handle) {
            var handles = handlesWeakMap.get(this);
            handles.push(handle);
            return {
                destroy: function () {
                    handles.splice(handles.indexOf(handle));
                    handle.destroy();
                }
            };
        },
        destroy: function () {
            var _this = this;
            return new Promise_1.default(function (resolve) {
                handlesWeakMap.get(_this).forEach(function (handle) {
                    handle && handle.destroy && handle.destroy();
                });
                handlesWeakMap.delete(_this);
                _this.destroy = noop;
                _this.own = destroyed;
                resolve(true);
            });
        }
    }, function (instance) {
        handlesWeakMap.set(instance, []);
    });
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.default = createDestroyable;
});
//# sourceMappingURL=../_debug/mixins/createDestroyable.js.map